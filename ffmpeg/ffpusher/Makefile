#################################################全局配置#################################################

#---------------基本定义------------------#
#项目名称定义
PROJECT_NAME=ffpusher
#版本定义
PROJECT_VERSION=1.0.0.0
#编译器定义
CROSS=
#目录定义
OUTPUT_PATH=./obj
LIB_PATH=/usr/local/lib
SRC_PATH=./app
TARGET_PATH=./bin
#用来存放版本号、时间等项目基本信息的头文件，有需要的地方可以包含其进去
BHIP_TIMESTAMP_FILE =$(SRC_PATH)/timestamp_autogenerated.h

#---------------头文件------------------#
#除SRC_PATH目录以外的头文件目录，都需要在此添加
INC_PATH += -I/usr/local/include


#---------------编译选项----------------#
CFLAGS += 
CXXFlAGS += -std=c++11


#---------------链接库路径--------------#
LD_PATH += -L$(LIB_PATH)


#---------------链接选项----------------#
LDFLAGS += -lpthread -lm
LDFLAGS += -lavformat -lavcodec -lavutil

##################################################编译规则####################################################
CC=$(CROSS)gcc
CXX=$(CROSS)g++
AR=$(CROSS)ar

TARGET= $(TARGET_PATH)/$(PROJECT_NAME)

SUBDIR = $(shell  find $(SRC_PATH) -type d)
INC_PATH += $(foreach n, $(SUBDIR), -I$(n))
	
vpath %.c $(SUBDIR)
vpath %.cpp $(SUBDIR)
vpath %.o $(OUTPUT_PATH)

SOURCES_FILE = $(notdir $(shell find $(SRC_PATH) -name "*.c"))
SOURCES_FILE_CPP = $(notdir $(shell find $(SRC_PATH) -name "*.cpp"))
OBJECTS += $(patsubst  %.c,  %.o, $(SOURCES_FILE))
OBJECTS += $(patsubst  %.cpp,  %.o, $(SOURCES_FILE_CPP))
DEP_FILES = $(patsubst  %.o,  $(OUTPUT_PATH)/%.d, $(OBJECTS))

all: version_file $(TARGET)

$(TARGET):$(OBJECTS)
	@echo "Linking: $@"
	$(CXX) -o $@ $(foreach n, $(OBJECTS), $(OUTPUT_PATH)/$(n)) $(LD_PATH) $(LDFLAGS)
	#******************************************************************************#
	#                          Bulid successful !                                  #
	#******************************************************************************#

%.o:%.cpp
	@echo "Compiling: $<"
	$(CXX) -c $< -o $(OUTPUT_PATH)/$@ -MMD $(CFLAGS) $(INC_PATH) -MT $@ -MF $(OUTPUT_PATH)/$(notdir $(patsubst  %.cpp, %.d,  $<))
	
%.o:%.c
	@echo "Compiling: $<"
	$(CC) -c $< -o $(OUTPUT_PATH)/$@ -MMD $(CFLAGS) $(INC_PATH) -MT $@ -MF $(OUTPUT_PATH)/$(notdir $(patsubst  %.c, %.d,  $<))

-include $(DEP_FILES)

print:
	@echo $(INC_PATH)
	@echo $(SOURCES_FILE)
	@echo $(SOURCES_FILE_CPP)
	

version_file:
	@echo "#define BH_PROJECT_NAME \"$(PROJECT_NAME)\"" > $(BHIP_TIMESTAMP_FILE)
	@echo "#define BH_SOFTWARE_VERSION \"$(PROJECT_VERSION)\"" >> $(BHIP_TIMESTAMP_FILE)
	@date +'#define BH_SOFTWARE_DATE "%b %d %C%y"' >> $(BHIP_TIMESTAMP_FILE)
	@date +'#define BH_SOFTWARE_TIME "%T"' >> $(BHIP_TIMESTAMP_FILE)
